<div style="overflow: hidden;">
  <table class="my-width-min flush--bottom" >
    <thead>
      <tr>
        <% if not session[:my_own] %>       <%# display only from 'List Assignment by userid' #%>
          <th class="t12">User</th>
        <% end %>
        <th class="t12">Assignments</th>
        <th class="t12">Date</th>
        <th class="t12">Status</th>
        <th>Instructions</th>
        <th class="t8">Number</th>
        <th class="t10">Action
          <a href="#" class="left_tooltip"><%= image_tag 'info.png', alt: 'Information', height: '14' %>
          <span>LS: List Assignment Detail;<br> AC: Accept Assignment Submitted;<br> UN: Unassign Images in This Assignment;<br> RA: Re_assign Images in This Assignment;<br> ER: Change Image Status in This Assignment as ERROR</span></a>
        </th>
      </tr>
    </thead>
  </table>

  <div class="scrollable">
    <table class=" table--bordered my-width table--data just--left">
      <tbody>
        <% prev_id = '' %>
        <% if @assignment.nil? %>
          No Assignment Exists
        <% else %>
          <% @assignment.each do |x| %>
            <tr>
              <% rows = x[:fields][:_id] != prev_id ? @count[x[:_id]] : 0 %>
              <% prev_id = x[:fields][:_id] %>
              <% assignment_type = x[:fields][:images][:status] == 'bt' ? 'transcriber' : 'reviewer' %>

              <% if rows != 0 %>
                <% if not session[:my_own] %>   <%# display only from 'List Assignment by userid' #%>
                  <% if rows != 0 %>
                    <td class="t12" rowspan=<%= rows %> style="vertical-align: top"><%= x[:fields][:userids][:userid] if !x[:fields][:userids].nil? %>&nbsp;</td>
                  <% end %>
                <% end %>
                <td class="t12"><%= x[:fields][:groups][:group_name] %>&nbsp;</td>
                <td class="t12"><%= x[:fields][:assign_date].to_date.strftime("%Y-%m-%d") %>&nbsp;</td>
                <td class="t12"><%= ImageServerImage::Status::ALL_STATUSES[x[:fields][:images][:status]] if !x[:fields][:images].nil? %>&nbsp;</td>
                <td><%= x[:fields][:instructions] %>&nbsp;</td>
                <td class="t8"><%= rows %>&nbsp;</td>

                <td class="t10">
                  <% case assignment_filter_list %>
                    <% when 'submitted_transcribe' %>
                      <%= link_to 'LS', list_assignment_images_assignment_path(x[:_id], :assignment_filter_list=>'submitted_transcribe', :source_id=>x[:fields][:source_id], :image_server_group_id=>x[:fields][:groups][:_id]), method: :get %>
                    <% when 'submitted_review' %>
                      <%= link_to 'LS', list_assignment_images_assignment_path(x[:_id], :assignment_filter_list=>'submitted_review', :source_id=>x[:fields][:source_id], :image_server_group_id=>x[:fields][:groups][:_id]), method: :get %>
                    <% else %>
                      <%= link_to 'LS', list_assignment_images_assignment_path(x[:_id], :assignment_filter_list=>'', :source_id=>x[:fields][:source_id], :image_server_group_id=>x[:fields][:groups][:_id]), method: :get %>
                  <% end %>
                  <% if !session[:my_own] %>
                    <% if params[:assignment].nil? %>
                      <% assignment_list_type = params[:assignment_list_type] %>
                    <% else %>
                      <% assignment_list_type = params[:assignment][:assignment_list_type] %>
                    <% end %>

                    <% if ['ts','rs'].include? x[:fields][:images][:status] %>
                      <%= link_to 'AC', assignment_path(x[:fields][:_id], :status=>x[:fields][:images][:status], :type=>'complete', :assignment_list_type=>assignment_list_type), data: { confirm: 'Click OK if the assignment has been Completed' }, method: :put %>
                    <% end %>
                    <%= link_to 'UN', assignment_path(x[:fields][:_id], :status=>x[:fields][:images][:status], :type=>'unassign', :assignment_list_type=>assignment_list_type), data: { confirm: 'Click OK to un-assign the assignment'}, method: :put %>
                    <%= link_to 'RA', re_assign_assignment_path(x[:fields][:_id], :image_server_group_id=>x[:fields][:images][:image_server_group_id], :assign_type=>assignment_type, :assignment_list_type=>assignment_list_type), data: { confirm: 'Do you want to re-assign images in this assignment?'} %>
                    <% if x[:fields][:images][:status] == 'rs' %>
                      <%= link_to 'ER', assignment_path(x[:fields][:_id], :status=>x[:fields][:images][:status], :type=>'error', :assignment_list_type=>assignment_list_type), data: { confirm: 'Click OK if you want to mark all images in this assignment as ERROR'}, method: :put %>
                    <% end %>
                  <% end %>
                </td>
              <% end %>
            </tr>
            <tr id="<%= x[:fields][:images][:_id] %>" style="display:none;"></tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
<div style="clear:both;"></div><br>
