<h1>Updating Freereg</h1>

<p><strong>We update freereg on a nightly basis</strong> rather than build it.&#160;</p>
<p>The workhorse for this is a&#160;rake task build:freereg_update[range,type,delta] which initiates freereg_csv_update_processor with the same parameters.</p>
<p><strong>range </strong>can be an individual file, all of a users files or an alphanumeric range. eg&#160;*/*.csv or */wry*.csv or userid/*.csv or userid/nfkaldba.csv or a-c or e-h</p>
<p><strong>type</strong> is the search record control.  search_records or create_search_records BOTH create search records; anything else and search records are not created</p>
<p><strong>delta</strong> can have 3 values. change; delta; process.</p>
<p>change means use the the file set located at  Rails.application.config.datafiles which is usually '/raid/freereg2/users' and the range as specified. The NORMAL use is with a single file ie userid/file.csv. It is the option used when a transcriber asks to process As Soon As Possible. I expect this is the option to be used for rspec purposes.</p>
<p>process means use the the file set located at  Rails.application.config.datafiles which is usually '/raid/freereg2/users' BUT instead of the range read the file located at Rails.application.config.processing_delta which is normally at '/raid/freereg2/log/processing_delta'. The file contains a list of files waiting to be processed. The file is created by the rake task<br />sudo -u webserv bundle exec rake RAILS_ENV=production build:get_waiting_file_list --trace. ie this option processes the files uploaded directly into FR (2 as we used to call it)</p>
<p>delta means use the the file set located at  Rails.application.config.datafiles_changeset which is usually '/raid/freereg2/freereg1/users' BUT instead of the range read the file located at Rails.application.config.datafiles_delta which is normally at '/raid/freereg2/log/freereg1.delta'. The file contains a list of files that have been changed on FR1. The file is created by the rsync task <br />sudo -u webserv rsync  -avz  --delete --exclude '.attic' --exclude '.errors' --exclude '.warnings' --exclude '.uDetails' /raid/freereg/users/ ${FREEREG2}/ 2&gt;${LOG_DIR}/rsync.errors | egrep -v '(^receiving|^sending|^sent|^total|^cannot|^deleting|^$|/$)' &gt; ${LOG_DIR}/freereg1.delta This does a sync of the real FR1 users file set with the FR2 copy of the FR1 file set. ie it processes files changed in FR1.<br /></p>