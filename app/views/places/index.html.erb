<% require 'chapman_code' %>

<div>  The data displayed in this table for  <b><%= @county  %></b> is based on the files when they were last updated on <%= Rails.application.config.dataset_date %>. 

</div>
<br>
   <% if flash[:notice] && session[:errors].nil? %>
    <div id="notice" style="color:green"><br>
  <% else %>
   <div id="notice" style="color:red"><br> 
    <% end %>
   <%= flash[:notice] %> 
    <% session[:errors] = nil %>
   <br>
    </div>
 <p> 
<div style="float:left;">  <%= button_to 'Create New Place', new_place_path, method: :get %></div>
<div  style="float:left;"> <%= button_to 'Create New Church', new_church_path, method: :get %></div>
<div  style="float:left;"> <%= button_to 'Create New Register', new_register_path, method: :get %></div>
<div  style="float:left;"> <%= button_to 'Back to my Resource Management options', manage_resource_path(session[:user]), method: :get %> </div>
<div style="clear:both;"> </div><br>

<div id="main"style="color:black">

<table style="width: 100%">
  <tr>
  
    <th style="width:18%">Place</th>
    <th style="width:18%">Alternate place name</th>
    <th style="width:8%">Genuki page</th>
    <th style="width:12%">Last amended</th>
    <th style="width:25%">Churches</th>
    <th style="width:19%">Action</th>
  </tr>

<% @places.each do |place| %>
  <tr id="<%=place.id%>">
    <td >
     <%= place.place_name %>
    </td>
       <td >
     <%= place.alternate_place_name %>
      </td>
  <td >
     <%= link_to('Genuki', place.genuki_url) unless place.genuki_url.nil? || place.genuki_url == "no url" %>
      </td>
     <td >
     <%= place.last_amended %>
      </td>
    <td >
     <ol>
<% place.churches.order_by(church: 1).each do |church| %>
<li>
<% session[:placeid] = place.id%>
<%= link_to(church.church_name, church_path(church)) %><br />


</li> 


<% end%>


    
     </ol>
 
    </td>

    <td >
   <%= link_to 'Show Place', place_path(place) %><br>  
<%= link_to 'Edit Place', edit_place_path(place) %><br> 

 <%= link_to 'Discard Place', place_path(place), method: :delete, data: { confirm: 'Are you sure?' } %><br>
 </td>

  </tr>
<% end %>
</table>


<br />
<div style="float:left;">  <%= button_to 'Create Place entry', new_place_path, method: :get %></div>
<div  style="float:left;"> <%= button_to 'Back to County Mangement Tools Page', manage_counties_path, method: :get %></div>
<div  style="float:left;"> <%= button_to 'Back to my Resource Management options', manage_resource_path(session[:user]), method: :get %> </div>
<div style="clear:both;"> </div><br>
