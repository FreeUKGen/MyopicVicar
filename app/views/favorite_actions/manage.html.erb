<% content_for :title, "Manage Favorite Actions" %>

<div class="container">
  <h2>Manage Favorite Actions</h2>
  <p class="text-muted">Select up to 5 actions to mark as favorites. They will appear at the top of your action sidebar.</p>

  <%= form_with url: update_favorites_path, method: :post, local: true do |form| %>
    <div class="row">
      <div class="col-md-8">
        <h4>Available Actions</h4>
        <div class="form-group">
          <% @available_actions.each do |action| %>
            <div class="form-check favorite-checkbox">
              <%= check_box_tag "favorite_actions[]", action, @favorite_actions.include?(action), 
                  class: "form-check-input", id: "action_#{action.parameterize}" %>
              <%= label_tag "action_#{action.parameterize}", action, class: "form-check-label" %>
              <small class="text-muted d-block">
                <%= UseridRole::OPTIONS_TITLES[action] if UseridRole::OPTIONS_TITLES[action] %>
              </small>
            </div>
          <% end %>
        </div>
      </div>
      
      <div class="col-md-4">
        <h4>Current Favorites</h4>
        <div id="selected-favorites">
          <% if @favorite_actions.present? %>
            <% @favorite_actions.each do |action| %>
              <div class="badge badge-primary mr-1 mb-1" id="favorite-<%= action.parameterize %>">
                <%= action %>
                <button type="button" class="btn-close btn-close-white" onclick="removeFavorite('<%= action %>')"></button>
              </div>
            <% end %>
          <% else %>
            <p class="text-muted">No favorites selected</p>
          <% end %>
        </div>
        
        <div class="mt-3">
          <small class="text-muted">
            <span id="favorite-count"><%= @favorite_actions.length %></span> of 5 favorites selected
          </small>
        </div>
      </div>
    </div>

    <div class="form-actions mt-4">
      <%= form.submit "Update Favorites", class: "btn btn-primary" %>
      <%= link_to "Cancel", :back, class: "btn btn-secondary" %>
    </div>
  <% end %>
</div>

<script>
  function updateFavoriteCount() {
    const selected = document.querySelectorAll('input[name="favorite_actions[]"]:checked');
    document.getElementById('favorite-count').textContent = selected.length;
    
    // Disable remaining checkboxes if 5 are selected
    const checkboxes = document.querySelectorAll('input[name="favorite_actions[]"]');
    checkboxes.forEach(checkbox => {
      if (selected.length >= 5 && !checkbox.checked) {
        checkbox.disabled = true;
      } else {
        checkbox.disabled = false;
      }
    });
  }

  function removeFavorite(action) {
    const checkbox = document.getElementById('action_' + action.replace(/\s+/g, '-').toLowerCase());
    if (checkbox) {
      checkbox.checked = false;
      updateFavoriteCount();
    }
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('input[name="favorite_actions[]"]');
    checkboxes.forEach(checkbox => {
      checkbox.addEventListener('change', updateFavoriteCount);
    });
    updateFavoriteCount();
  });
</script>
