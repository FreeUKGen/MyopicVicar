<% print_friendly = (defined?(@printable_format) && @printable_format) ? true : false %>
<% title "Search Results" %>
<!--h1 class="accessibility">Search results</h1-->
<%= render 'flash_notice' %>
<%# show_contents_link%>
<h1 class="semi-kilo project-font-color container ">Results</h1>
<div class="grid__item one-whole lap-one-whole palm-one-whole push-half--bottom hard--left">
  <%= link_to "Revise Search", new_search_query_path(:search_id => @search_query), :class => "btn   btn--small " %>
  <%= link_to "New Search", new_search_query_path, :class => "btn   btn--small  " %>
  <%= link_to "View Search Criteria", '#', class: "btn   btn--small" , id: "view_search_criteria"%>
</div>
<h4 class="accessibility">Search Criteria</h1>
<% if @search_query.present? %>
  <%= render 'nav_header' %>
  <%= render 'display_search_criteria'%> <!--#unless appname_downcase=='freebmd'
  <%# if appname_downcase=='freebmd'%>
    <%#= render 'display_search_criteria' %>
  <%# end %> -->
  <!--div class='grid'>
    <div class="grid__item one-whole lap-one-whole palm-one-whole">
      <%#= link_to "Download", '#', :class => "btn btn--small push-half--right push-half--top" %>
    </div>
  </div-->
  <% unless print_friendly %>
    <div class='container push--bottom'>
      <div class="seven-tenths palm-one-whole">
        <div class="grid">
          <div class="grid__item one-quarter lap-one-half palm-one-half">
            <strong><%= pluralize(@search_results.count, 'Results')%></strong>
          </div>
          <aside class="grid__item one-sixth lap-one-third palm-one-half  float--right">
            <%= select_tag('tools', options_for_select([['About this Query', "#{about_search_query_path(@search_query, :page_number => @page_number)}".html_safe], ['Printable Format', "#{show_print_version_search_query_path}".html_safe]]), {prompt: '<i class="fa fa-cog" aria-hidden="true"></i>  Tools'.html_safe, id: 'tools', tabindex: "0", class: 'btn--small', onchange: "window.location.replace(window.location.origin + this.value);"}) %>
          </aside>
        </div>
      </div>
    </div>
    <hr class='seven-tenths palm-one-whole push--top'>
  <% end %>

  <section>
  <% max_result = FreeregOptionsConstants::MAXIMUM_NUMBER_OF_RESULTS unless appname_downcase == 'freebmd'%>
  <% max_result = FreeregOptionsConstants::MAXIMUM_NUMBER_OF_BMD_RESULTS if appname_downcase == 'freebmd'%>
    <% if @result_count >= max_result %>
      <%= render 'too_many_results' %>
    <% else %>
      <% if @result_count == 0 && ( @ucf_results && @ucf_results.size == 0) %>

        <%= render 'no_results' %>
      <% else %>
        <%# if device_type == :desktop || device_type == :tablet %>
          <% case MyopicVicar::Application.config.template_set%>
          <% when 'freereg'%>
            <div class="container">
              <div class="grid">
                <div class="" id='results_table'>
                  <%= render(:partial => app_specific_partial("desktop"), :locals => {:search_results => @search_results, :inclusive => @search_query.inclusive, :witness =>@search_query.witness, :first_name => @search_query.first_name, :last_name => @search_query.last_name, :ucf_results => false})  %>
                </div>
                <div id='results_table_ad'>
                  <span>  Advertisement</span>
                  <div id='freereg_sidebar_left_desk'>
                  </div>
                </div>
              </div>
            </div>
          <% when 'freecen'%>
            <div class="container">
              <div class="grid">
                <div class="grid__item  palm-one-whole " id='results_table'>
                  <%= render(:partial => app_specific_partial("desktop"), :locals => {:search_results => @search_results, :inclusive => @search_query.inclusive, :witness =>@search_query.witness, :first_name => @search_query.first_name, :last_name => @search_query.last_name, :ucf_results => false})  %>
                </div>
                <% if device_type == :desktop %>
                  <div  id='results_table_ad'>
                    <span>Advertisement</span>
                    <%= adsence_right_side_banner %>
                  </div>
                <% end %>
              </div>
            </div>
          <% when 'freebmd'%>
            <% unless print_friendly %>
              <div class='container push--bottom'>
                <div class="seven-tenths lap-seven-tenths palm-one-whole">
                  <div class="grid">
                    <div class="grid__item one-quarter lap-one-half palm-one-half">
                      <%= form_tag search_query_path(@search_query), method: :get, id: 'filter_form' do %>

                        <%= select_tag('filter_option', options_for_select([['Births', "1"], ['Deaths', "2"], ['Marriages', "3"]], selected: @filter_condition), {:prompt => "Filter By", id: 'filter_results', tabindex: "0"}) %>
                      <% end %>
                    </div>
                    <aside class="grid__item one-quarter lap-one-half palm-one-half  float--right">
                      <%= form_tag search_query_path(@search_query), method: :get, id: 'limit_form' do %>
                        Show <%= select_tag :results_per_page, options_for_select([5,20,40,60,80,100], selected: @results_per_page), class: 'three-fifths lap-three-fifths palm-three-fifths'%>
                      <% end %>
                    </aside>
                  </div>
                </div>
              </div>
            <% end %>
            <div class="grid">
              <div class="grid__item seven-tenths lap-seven-tenths palm-one-whole " id='bmd_results'>
                <%= render(:partial => app_specific_partial("desktop"), :locals => {:search_results => @search_results, :first_name => @search_query.first_name, :last_name => @search_query.last_name, :ucf_results => false})  %>
              </div>
              <%# raise device_type.inspect%>
              <% unless print_friendly %>
                <% if device_type == :desktop %>
                  <div class="grid__item two-tenths lap-two-tenths palm-one-whole "  id='results_table_ad'>
                    <center><p>Advertisement</p>
                    <%= adsence_right_side_banner %></center>
                  </div>
                <% end %>
              <% end %>
            </div>
          <% else %>
            <%= render(:partial => app_specific_partial("desktop"), :locals => {:search_results => @search_results, :inclusive => @search_query.inclusive, :witness =>@search_query.witness, :first_name => @search_query.first_name, :last_name => @search_query.last_name, :ucf_results => false})  %>
          <% end%>
      <%# else %>
        <%#= render(:partial => app_specific_partial("mobile"), :locals => {:search_results => @search_results, :ucf_results =>  @ucf_results}) %>
      <%# end %>
    <% end%>
    <% if @result_count > 10 && @result_count < max_result %>
      <br>
      <%= render 'nav_header' %>
      <a href="#" class="btn  btn--small">Go to top</a>
    <% end %>
    <% if @result_count > 0 && @result_count < max_result %>
      <% if appname_downcase == 'freebmd'%>
        <%#= render 'bmd_search_results_footer' %>
      <% else %>
        <%= render 'please_donate' %>
      <% end %>
    <% end %>
  <% end %>
</section>
<% else %>
  <%= render 'no_results' %>
<% end %>
<script type="text/javascript">
  var result = window.canRunAds;
  function changeClass(screen_width) {
    if (screen_width.matches) {
      $("#results_table").removeClass("grid__item  seven-tenths  palm-one-whole").addClass('');
    } else {
      if(result === true) {
        $("#results_table").addClass("grid__item  seven-tenths lap-six-tenths palm-one-whole");
        $("#results_table_ad").addClass("grid__item  three-tenths  palm-one-whole");
      } else {
        $("#results_table_ad").hide();
        $("#results_table").addClass("");
      }
    }
  };
  var screen_width = window.matchMedia("(max-width: 1000px)")
  changeClass(screen_width)
  screen_width.addListener(changeClass);

  //js code to filter results
  $(function(){
    $('#filter_results').change(
      function() {
       $('#filter_form').submit();
      });
  });

  //js code for pagination
  $(function(){
    $('#results_per_page').change(
      function() {
       $('#limit_form').submit();
      });
  });

  //js code to show search criteria
  $('#view_search_criteria').click(
    function() {
     $('#search_criteria_container').show();
     $('#view_search_criteria').hide();
  });

  //js code to hide show criteria button on load
  //$('#view_search_criteria').hide();


  //$(document).ready(function() {
   // $("#filter_results").change(function() {
    //  var condition = $(this).val();
   //   var search_id = $('#search_id').val();
    //  $.ajax({
    //      url: '<%= search_query_path(params[:id])%>',
    //      type: "GET",
     //     data: {
     //         selected_condition: condition,
     //         id: search_id
     //     }
     // });
   // });
 // });
</script>
<style type="text/css">
  @media only screen and (max-width: 1000px) {
  .advert_div {
    display: none !important;
  }
  }
</style>
