<% if flash[:notice] %>
<div id="notice" style="color:red"><br>
  <%= flash[:notice] %>  <% flash[:notice] = nil%><br>
</div>
<% end %>
<section  >
  <h2 class="text--center"><%= @search_query.result_count %> Search Results</h2>
  <% if @search_query.result_count == FreeregOptionsConstants::MAXIMUM_NUMBER_OF_RESULTS %>
  <h4 class="text--center" style="color:red">Your results were limited to the maximum number of results. We suggest you may wish to refine your search to ensure a complete set of results</h4>

  <% end%>
  <div class="text--center"><%= link_to "Revise Search", new_search_query_path(:search_id => @search_query), :class => "btn  btn--small " %> 
   <%= link_to "New Search", new_search_query_path, :class => "btn  btn--small " %>
   <%= link_to("About This Query", about_search_query_path(@search_query, :page_number => @page_number), :class => "btn  btn--small ")%> 
  <% if @search_query.can_be_broadened? %>
   <%= link_to "Broaden Search", broaden_search_query_path(:search_id => @search_query) , :class => "btn  btn--small  "%> 
  <% end %>
   <% if @search_query.can_be_narrowed? %>
   <%= link_to "Narrow Search", narrow_search_query_path(:search_id => @search_query), :class => "btn  btn--small  " %> 
  <% end %>
  </div>
  <div style="clear:both;"> </div>
</section>
<section class="island  island--light " >
  <div class="criteria-group">
    <% search_params_for_display(@search_query).each do |name, value| %>
    <dl class="criteria">
      <dt class="criteria__name"><%= name %></dt>
      <dd class="criteria__value"><%= value %></dd>
    </dl>
    <% end %>
  </div>
</section>

      <% if @search_results.size == 0 %>

        <p>No results found! This could either be because there are no transcriptions for the Places you were searching, review our  <%=link_to("Database Contents",main_app.freereg_contents_path, :class => "btn  btn--small")%> for what has been transcribed. Alternatively you may need to recast your search options, see our <%= link_to "Tips for Searching", "/tips-for-searching-the-database", :class => "btn  btn--small" %> for advise on how to get the most out of your searches</p>
      <% else %>
     
<section class="island  " >
  <div class="table-wrapper">
    <div class="grid">
        <table class="table--bordered grid__item one-whole" >
        <colgroup >
        <col class=t20>
        <col class=t10 >
        <col class=t10 >
        <col class=t10>
        <col class=t20>
        <col class=t5>
        </colgroup>
        <thead  >
          <th>
            <%= link_to('Participants', reorder_search_query_path(@search_query, :order_field => SearchQuery::SearchOrder::NAME)) %><br>
            <a href="#" class="bottom_tooltip"><img alt="Information" height="16" src="/assets/refinery/icons/information.png"><span>Name of main person in the record. Click heading to sort by the name. </span></a>
          </th>
          <th>
            <%= link_to('Type', reorder_search_query_path(@search_query, :order_field => SearchQuery::SearchOrder::TYPE)) %><br>
            <a href="#" class="bottom_tooltip"><img alt="Information" height="16" src="/assets/refinery/icons/information.png"><span>Type of record. Click heading to sort by type</span></a>
          </th>
          <th>
            <%= link_to('Date', reorder_search_query_path(@search_query, :order_field => SearchQuery::SearchOrder::DATE)) %><br>
            <a href="#" class="bottom_tooltip"><img alt="Information" height="16" src="/assets/refinery/icons/information.png"><span>Date of event. Please note that calendar changed in 1752. Click heading to sort by the date</span></a>
          </th>
          <th>
            <%= link_to('County', reorder_search_query_path(@search_query, :order_field => SearchQuery::SearchOrder::COUNTY)) %><br>
            <a href="#" class="bottom_tooltip"><img alt="Information" height="16" src="/assets/refinery/icons/information.png"><span>County in which event was recorded. Click heading to sort by the county</span></a>
          </th>
          <th>
            <%= link_to('Location', reorder_search_query_path(@search_query, :order_field => SearchQuery::SearchOrder::LOCATION)) %><br>
            <a href="#" class="bottom_tooltip"><img alt="Information" height="16" src="/assets/refinery/icons/information.png"><span>Place and Church in which event was recorded. Click heading to sort by the location</span></a>
          </th>
          <th>Detail<br>
            <a href="#" class="left_tooltip"><img alt="Information" height="16" src="/assets/refinery/icons/information.png"><span>Click on the detail link in the record below to get transcription details</span></a>
          </th>
        </thead >
        <% @search_results.each do |search_record| %>
        <tbody >
          <tr id="<%=search_record.id%>">
            <td>
              <% search_record.transcript_names.uniq.each_with_index do |name, i| %>
              <% if  name['type'] == 'primary' %>
              <% if i > 0 %>
              <br/>
              <% end%>
              <%= "#{name['first_name']} #{name['last_name']} " %>
              <% end %>
              <% end%>
            </td>
            
            <td>
              <%= RecordType::display_name(search_record.record_type) %>
            </td>
            <td>
              <%= raw(search_record.transcript_date.gsub(' ', '&nbsp;')) unless search_record.transcript_date.nil?%>
            </td>
            <td>
              <%= ChapmanCode::name_from_code(search_record.chapman_code) %>
            </td>
            <td>
              <%= format_location(search_record) %>
            </td>
            <td>
              <%= link_to("Detail", search_record_path(search_record, :search_id => @search_query)) %>
              <% if session[:viewed] %>
                <i>
                <%= "(viewed)" if session[:viewed].include?("#{search_record.id}") %>
                </i>
              <% end %>
            </td>
          </tr>
        </tbody>
        <% end %>
      </table>
    </div>
    <% end %>
    
  </div>
 
  <br>
  <% if @search_query.result_count > 5 %>
  <div class="text--center"><%= link_to "Revise Search", new_search_query_path(:search_id => @search_query), :class => "btn  btn--small " %> 
  <%= link_to "New Search", new_search_query_path, :class => "btn  btn--small " %> 
  <%= link_to("About This Query", about_search_query_path(@search_query, :page_number => @page_number), :class => "btn  btn--small ")%> 
  <% if @search_query.can_be_broadened? %>
  <%= link_to "Broaden Search", broaden_search_query_path(:search_id => @search_query) , :class => "btn  btn--small "%> 
  <% end %>
  <% if @search_query.can_be_narrowed? %>
  <%= link_to "Narrow Search", narrow_search_query_path(:search_id => @search_query), :class => "btn  btn--small  " %>
  <% end %>
  
  <a href="#"  class="btn  btn--small ">Go to top</a>
  </div>
  <% end %>
</section>