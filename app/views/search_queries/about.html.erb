<div id="nav">
	<ul>
	    <li><%= link_to "New Search",  new_search_query_path%></li>
	    <li><%= link_to "Revise Search", new_search_query_path(:search_id => @search_query) %></li>
	</ul>
</div>


<h1>About This Query</h1>

<p>How did your query match against the FreeREG database?</p>

<h2>Name</h2>

<p>
	Search Criteria: 
	<b>First Name</b> is <b><i><%= @search_query.first_name || "blank"%></i></b>, 
	<b>Last Name</b> is <b><i><%= @search_query.last_name  || "blank" %></i></b>.
	<b>Exact matching</b> is <b><i><%= @search_query.fuzzy ? "disabled" : "enabled" %></i></b>
</p>
<p>
	Search Logic:
	<% if @search_query.first_name %>
		Records with a first name of <b><i><%= @search_query.first_name %></i></b> (ignoring capitalization)
		<% if @search_query.fuzzy %>
			and records with a first name whose soundex is <%= fuzzy(@search_query.first_name)%>
		<% end %>.
		<% emendations = EmendationRule.where(:replacement => @search_query.first_name.downcase).all.to_a %>
		<% if emendations && emendations.size > 0 %>
			In addition, match records whose first name is
			<b><i><%= raw(emendations.map{|e| e.original }.join("</i></b> or <b><i>")) %> </i></b> (ignoring capitalization).
		<% end %>
	<% end %>
	<% if @search_query.last_name %>
		<br />Records with a last name of <b><i><%= @search_query.last_name %></i></b> (ignoring capitalization)	
		<% if @search_query.fuzzy %>
			and records with a last name whose soundex is <%= fuzzy(@search_query.last_name)%>
		<% end %>
	<% end %>
</p>


<h2>Date</h2>
<p>
	<% unless @search_query.start_year.blank? && @search_query.end_year.blank? %>
		Search Criteria: 
		<% if @search_query.start_year %>
			<b>Start Year</b> is <b><i><%= @search_query.start_year %></i></b>.
		<% end %>
		
		<% if @search_query.end_year %>
			<b>End Year</b> is <b><i><%= @search_query.end_year %></i></b>.
		<% end %>
	<% else %>
		<i>No date criteria specified.</i>
	<% end %>
</p>
<% unless @search_query.start_year.blank? && @search_query.end_year.blank? %>
	<p>
		Search Logic:
			Records with dates <b><i>on or after <%= format_start_date(@search_query.start_year) %></i></b> (New Style) and dates  <i><b>before <%= format_end_date(@search_query.end_year) %></i></b> (New Style).
			
	
	
	</p>
<% end %>

<h2>Records</h2>
<i>to do</i>


<h2>Location</h2>


<% if @search_query.radius_search? %>
	<p>
		Search Critera: 
			<b>Search additional places</b> 
			near 
			<b><%= @search_query.places.map {|pl| pl.place_name }.join(" or ")%></b> 
	</p>
	<p>
		Search Logic:
			Records within these places:
			<ul>
				<% @search_query.all_radius_places.each do |near_place| %>
					<li>
						<%= near_place.place_name%> (<%= near_place.geo_near_distance %> <%=Place::MeasurementSystem::system_to_units(@search_query.place_system)%>)
					</li>
				<% end %>
			</ul>
	</p>
<% end %>
	
<i>to do: counties, specific places</i>


<div id="nav">
	<ul>
	    <li>
	    	<%= link_to "back", search_query_path(@search_query, :page_number => @page_number) %>
    	</li>
	</ul>
</div>
